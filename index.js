var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,c){for(var b,e=0;e<c.length;e++)b=c[e],b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(a,b.key,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_reduxStoreInit=require("redux-store-init"),_reduxStoreInit2=_interopRequireDefault(_reduxStoreInit),_reduxThunk=require("redux-thunk"),_reduxThunk2=_interopRequireDefault(_reduxThunk);Object.defineProperty(exports,"__esModule",{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function isFunction(a){return"function"==typeof a}function isString(a){return"string"==typeof a}var ErrorMap={CTX:"Redux-Fine: \u8bf7\u4e0d\u8981\u5728 constructor \u6216 commit callback \u91cc\u4f7f\u7528 this.store\u3001this.state\u3001this.app",INT:"Redux-Fine: \u4f60\u9700\u8981\u5148\u8c03\u7528 store \u624d\u53ef\u4ee5",TYPE:"Redux-Fine: \u53c2\u6570\u7c7b\u578b\u9519\u8bef"},gb={module:{},reducer:{},initState:{},store:{},config:{},mixin:{}},_module=function(a,b){if("undefined"==typeof a)return Object.keys(gb.module||{})||[];if("string"==typeof a&&!b)return gb.module[a];"string"==typeof a&&b&&(b=new b(a),gb.module[a]=b,gb.initState[a]=b.initState,gb.reducer[a]=function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:gb.initState[a],d=arguments[1],e=d.newState;return-1<d.type.indexOf(a)&&isFunction(e)?e(b):b})},_store=function(a){_config({});var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return b.push(_reduxThunk2.default),a=a||gb.initState,gb.store=(0,_reduxStoreInit2.default)({reducers:gb.reducer,initState:a,devtool:gb.config.devtool},b.concat(gb.config.middlewares)),Object.keys(gb.module).forEach(function(a){a=gb.module[a].initialized;isFunction(a)&&a()}),gb.store},_action=function(a){var b={};return(Object.keys(gb.module[a]||{})||[]).forEach(function(c){isFunction(gb.module[a][c])&&"_"!==c[0]&&(b[c]=gb.module[a][c])}),b},Module=function(){function a(b){_classCallCheck(this,a);this._name=b;this.initState={}}return _createClass(a,[{key:"initialized",value:function(){}},{key:"commit",value:function(){for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];var e=null;return 0===Object.keys(gb.store).length?console.error(ErrorMap.INT):(1===c.length&&isFunction(c[0])?e=gb.store.dispatch({type:this._name+"-"+Date.now(),newState:function(a){return c[0](a)||a}}):2===c.length&&isFunction(c[1])?isString(c[0])?e=gb.store.dispatch({type:this._name+"-"+c[0],newState:function(a){return c[1](a)||a}}):(e=gb.store.dispatch({type:this._name+"-"+Date.now(),newState:function(a){return c[0](a)||a}}),setTimeout(function(){c[1](gb.store.getState())},50)):3===c.length&&isFunction(c[1])?(e=gb.store.dispatch({type:this._name+"-"+c[0],newState:function(a){return c[1](a)||a}}),isFunction(c[2])&&setTimeout(function(){c[2](gb.store.getState())},50)):console.error(ErrorMap.TYPE),function(){return e})}},{key:"mixin",get:function(){return gb.mixin}},{key:"store",get:function(){try{return gb.store.getState()}catch(b){console.error(ErrorMap.CTX)}}},{key:"state",get:function(){return this.store[this._name]}},{key:"app",get:function(){var a={};return Object.keys(gb.module).forEach(function(b){a[b]=_action(b)}),{module:Object.assign(gb.module,{}),mixin:Object.assign(gb.mixin,{}),action:a}}}]),a}();function _config(a){a=_extends({devtool:!1,middlewares:[]},a);gb.config=a}function _mixin(a,b){gb.mixin[a]=b}exports.default={module:_module,store:_store,action:_action,config:_config,mixin:_mixin,Module:Module};