var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a};import Store from'redux-store-init';import thunk from'redux-thunk';function isFunction(a){return'function'==typeof a}function isString(a){return'string'==typeof a}const ErrorMap={CTX:'Redux-Fine: Please do not use this.store, this.state, this.app in constructor or commit callback.',INT:'Redux-Fine: You need to call store first.',TYPE:'Redux-Fine: wrong parameter type.'},om=['mixin','store','state','initState','initialized','commit','app','helper','constructor'],$={module:{},reducer:{},initState:{},store:{},config:{},action:{},mixin:{},helper:{}},_module=(a,b)=>{if('undefined'==typeof a)return Object.keys($.module||{})||[];if('string'==typeof a&&!b)return $.module[a];if('string'==typeof a&&b){const c=new b(a);$.module[a]=c,$.initState[a]=c.initState,$.reducer[a]=(d=$.initState[a],e)=>{const{type:f,newState:g}=e;return-1<f.indexOf(a)&&isFunction(g)?g(d):d}}},_store=(a,b=[])=>{return _config({}),b=[...$.config.middlewares,thunk],a=a||$.initState,$.store=Store({reducers:$.reducer,initState:a,devtool:$.config.devtool},b),Object.keys($.module).forEach(c=>{const d=$.module[c].initialized;isFunction(d)&&d.bind($.module[c])}),$.store},_action=a=>{const b={},c=Object.keys($.module[a]||{});if(0!==c.length)return c.forEach(d=>{if(isFunction($.module[a][d])&&'_'!==d[0]){if(om.indexOf(om)||-1<Object.keys($.mixin).indexOf(d))return;b[d]=(...e)=>{return isFunction($.module[a][d])&&$.module[a][d].apply($.module[a],e),()=>{}}}}),b};class _Module{constructor(a){this._name=a,this.initState={},Object.keys($.mixin).forEach(b=>{-1===om.indexOf(b)&&(this[b]=$.mixin[b])})}initialized(){}get helper(){return $.helper}get store(){try{return $.store.getState()}catch(a){console.error(ErrorMap.CTX)}}get state(){return this.store[this._name]}commit(...a){let b=null;const c=(()=>{const d=new Date,e=o=>10>o?'0'+o:o,f=d.getHours(),g=d.getMinutes(),j=d.getSeconds(),l=d.getMilliseconds();return`[${e(f)}:${e(g)}:${e(j)}.${l}]`})();return 0===Object.keys($.store).length?console.error(ErrorMap.INT):(1===a.length&&isFunction(a[0])?b=$.store.dispatch({type:`${this._name}-${c}`,newState:d=>a[0](d)||d}):2===a.length&&isFunction(a[1])?isString(a[0])?b=$.store.dispatch({type:`${this._name}-${a[0]}`,newState:d=>a[1](d)||d}):(b=$.store.dispatch({type:`${this._name}-${c}`,newState:d=>a[0](d)||d}),setTimeout(()=>{a[1]($.store.getState())},20)):3===a.length&&isFunction(a[1])?(b=$.store.dispatch({type:`${this._name}-${a[0]}`,newState:d=>a[1](d)||d}),isFunction(a[2])&&setTimeout(()=>{a[2]($.store.getState())},20)):console.error(ErrorMap.TYPE),b)}get app(){const a={};return Object.keys($.module).forEach(b=>{a[b]=_action(b)}),{module:Object.assign($.module,{}),mixin:Object.assign($.mixin,{}),action:a}}}function _config(a){$.config=_extends({devtool:!1,middlewares:[]},a,$.config)}function _mixin(a,b){$.mixin[a]=b}function _helper(a,b){$.helper[a]=b}export const action=_action;export const store=_store;export const mixin=_mixin;export const module=_module;export const config=_config;export const helper=_helper;export const Module=_Module;export default{store:_store,mixin:_mixin,module:_module,action:_action,config:_config,helper:_helper,Module:_Module,_$:$};