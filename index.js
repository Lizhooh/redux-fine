'use strict';var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a},_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_reduxStoreInit=require('redux-store-init'),_reduxStoreInit2=_interopRequireDefault(_reduxStoreInit),_only2=require('only'),_only3=_interopRequireDefault(_only2),_reduxThunk=require('redux-thunk'),_reduxThunk2=_interopRequireDefault(_reduxThunk);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function isFunction(a){return'function'==typeof a}function isString(a){return'string'==typeof a}var gb={modules:{},reducers:{},initState:{},store:{},config:{}},tasks=[],createModule=function(a,b){return'undefined'==typeof a?Object.keys(gb.modules||{})||[]:'string'!=typeof a||b?void('string'==typeof a&&b&&tasks.push(function(){var c=new b(a);gb.modules[a]=c,gb.initState[a]=c.initState,gb.reducers[a]=function(){var f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:gb.initState[a],g=arguments[1],d=g.type,e=g.newState;return-1<d.indexOf(a)&&isFunction(e)?e(f):f}})):gb.modules[a]},createStore=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[_reduxThunk2.default];return tasks.forEach(function(c){return c()}),tasks=[],a=a||gb.initState,gb.store=(0,_reduxStoreInit2.default)({reducers:gb.reducers,initState:a,devtool:gb.config.devtool},b.concat(gb.config.middlewares)),gb.store},getAction=function(a){var b={},c=Object.keys(gb.modules[a]||{})||[];return c.forEach(function(d){isFunction(gb.modules[a][d])&&'_'!==d[0]&&(b[d]=gb.modules[a][d])}),b},Module=function(){function a(b){var d=this;_classCallCheck(this,a),this._name=b,this.initState={};var c=Object.keys(gb.config.moduleMixin||{});0<c.length&&c.forEach(function(e){d[e]=gb.config.moduleMixin[e]})}return _createClass(a,[{key:'commit',value:function commit(){for(var c=arguments.length,b=Array(c),d=0;d<c;d++)b[d]=arguments[d];return 0===Object.keys(gb.store).length?console.error('Redux-Fine: \u4F60\u9700\u8981\u5148\u8C03\u7528 store \u624D\u53EF\u4EE5'):(1===b.length&&isFunction(b[0])?gb.store.dispatch({type:this._name+'-'+Date.now(),newState:function newState(e){return b[0](e)||e}}):2===b.length&&isFunction(b[1])?isString(b[0])?gb.store.dispatch({type:b[0]+'-'+Date.now(),newState:function newState(e){return b[1](e)||e}}):(gb.store.dispatch({type:this._name+'-'+Date.now(),newState:function newState(e){return b[0](e)||e}}),setTimeout(function(){b[1](gb.store.getState())},16)):3===b.length&&isFunction(b[1])?(gb.store.dispatch({type:b[0]+'-'+Date.now(),newState:function newState(e){return b[1](e)||e}}),isFunction(b[2])&&setTimeout(function(){b[2](gb.store.getState())},16)):console.error('Redux-Fine: \u53C2\u6570\u7C7B\u578B\u9519\u8BEF'),function(){})}},{key:'only',value:function only(){return _only3.default.apply(void 0,b)}},{key:'store',get:function get(){try{return gb.store.getState()}catch(b){console.error('Redux-Fine: \u8BF7\u4E0D\u8981\u5728 commit \u7684\u56DE\u8C03\u51FD\u6570\u91CC\u4F7F\u7528 this.store \u6216 this.state')}}},{key:'state',get:function get(){return this.store[this._name]}}]),a}();function setConfig(a){tasks.shift(function(){a=_extends({devtool:!1,middlewares:[],moduleMixin:{}},a),gb.config=a})}exports.default={modules:createModule,store:createStore,actions:getAction,Module:Module,config:setConfig};